@model CheckoutViewModel

@{
    Layout = null;
    decimal totalPrice = Model.Products.Sum(cartProducts => cartProducts.totalPrice);
    bool freeDelivery = totalPrice >= 450 ? true : false;
}

<!DOCTYPE html>
<html>
<head>
    <title>Checkout - Dunder Mifflin</title>
    <link rel="stylesheet" asp-href-include="/lib/bootstrap/css/bootstrap.min.css" />
    <link rel="stylesheet" asp-href-include="/lib/font-awesome/css/all.min.css" />
    <link rel="stylesheet" asp-href-include="/css/custom.css" />
</head>
<body>
    <header class="container-fluid">
        <nav class="navbar navbar-expand-md shadow fixed-top bg-primary navbar-dark">
            <a class="navbar-brand ms-1" asp-action="Index" asp-controller="Home">Dunder Mifflin Paper Company</a>
        </nav>
    </header>
    <main class="container" style="margin-top:80px;">
        @if (TempData["Message"] != null)
        {
            <div class="d-flex justify-content-center" id="disappearingAlert" style="width:100%;position:fixed;left:0;">
                <div class="alert alert-dismissible alert-danger" role="alert">
                    @TempData["Message"]
                    <button type="button" class="ms-3 p-0 btn-close" style="position: inherit;padding: 0;align-self: center;"
                            data-bs-dismiss="alert" aria-label="Close">
                    </button>
                </div>
            </div>
        }
        <div class="d-flex justify-content-between">
            <h4 class="">Review your order</h4>
            <a asp-action="Index" asp-controller="Cart" class="text-primary default" style="text-decoration:underline">
                <i class="fa-solid fa-shopping-cart"></i> Back to cart
            </a>
        </div>
        <form name="OrderReview" asp-action="Add" asp-controller="Order" method="post">
            <div class="row mt-4">
                <div class="col-md-8">
                    <div class="bg-white px-3 py-3 mb-3">
                        <p>Delivery Method</p>
                        <input name="DeliveryMethod" value="Delivery" hidden />
                        <button type="button" class="btn btn-primary" onclick="SelectDeliveryMethod('Delivery')" id="Delivery" style="margin-right:10px"> Delivery</button>
                        <button type="button" class="btn btn-outline-primary" onclick="SelectDeliveryMethod('Collection')" id="Collection"> Collection</button>
                    </div>
                    <div class="bg-white px-3 py-3 mb-3" id="address">
                        <div class="d-flex justify-content-between mb-n1">
                            <p>Delivery Address</p>
                            <a asp-action="Add" asp-controller="Address" asp-route-source="Checkout">Add Address</a>
                        </div>
                        <hr />
                        @{
                            int index = 0;
                        }

                        <input type="radio" name="addressID" value="0" hidden />
                        @foreach (Address address in Model.Addresses.Take(2))
                        {
                            <div class="d-flex alight-content-center mt-2">
                                <input type="radio" class="me-3" name="addressID" id="@address.AddressID" value="@address.AddressID" @(index == 0 ? "checked" : "") />
                                <label for="@address.AddressID">
                                    <h6>
                                        <strong>
                                            @address.HouseNumber @address.StreetName,
                                            <br />@address.Surburb, @address.City, @address.PostalCode
                                        </strong>
                                    </h6>
                                </label>
                            </div>
                            index++;
                        }
                        @if (Model.Addresses.Count > 2)
                        {
                            <button type="button" onclick="Show('more')" id="showMore" class="btn cart-button">Show More</button>
                            <div id="moreAddresses" hidden>
                                @for (int i = index; i < Model.Addresses.Count; i++)
                                {
                                    var address = Model.Addresses[i];
                                    <div class="d-flex alight-content-center mt-2">
                                        <input type="radio" class="me-3" name="addressID" id="@address.AddressID" value="@address.AddressID" />
                                        <label for="@address.AddressID">
                                            <h6>
                                                <strong>
                                                    @address.HouseNumber @address.StreetName,
                                                    <br />@address.Surburb, @address.City, @address.PostalCode
                                                </strong>
                                            </h6>
                                        </label>
                                    </div>
                                }
                            </div>
                            <button type="button" onclick="Show('less')" id="showLess" class="btn cart-button" hidden>Show Less</button>
                        }
                    </div>
                    <div class="bg-white px-3 py-3 mb-2">
                        <p class="mb-1">Delivered by</p>
                        <hr />
                        <h6 class="">
                            <strong>
                                @DateTime.Now.AddDays(3).ToString("dddd, dd MMMM yyyy")
                            </strong>
                        </h6>
                        @if (freeDelivery)
                        {
                            <p>Free Delivery</p>
                        }
                        else
                        {
                            <p>Standard Delivery &bull; R60</p>
                        }

                    </div>
                </div>
                <div class="col-md-4 bg-white px-5 py-3 shadow" style="height:fit-content;">
                    <h5 class="text-secondary mb-0">Order Summary</h5>
                    <div class="mt-3 mb-2 d-flex justify-content-between">
                        <div class="d-flex align-items-end" style="">
                            @Model.Products.Sum(cartProducts=>cartProducts.PurchaseQuantity) items
                        </div>
                        <span class="">
                            R <span id="total">@totalPrice</span>
                        </span>
                    </div>
                    <div class="mb-2 d-flex justify-content-between">
                        <div class="d-flex align-items-end" style="">
                            Delivery:
                        </div>
                        <span class="">
                            <span id="total">@(freeDelivery ? "Free" : "R 60")</span>
                        </span>
                    </div>
                    <hr />
                    <div class="mb-3 d-flex justify-content-between">
                        <h5>
                            TO PAY:
                        </h5>
                        <h5 class="text-success">
                            R <span id="total">@(totalPrice + (freeDelivery ? 0 : 60))</span>
                        </h5>
                    </div>
                    <button class="btn btn-success w-100" type="submit">Place Order</button>

                </div>
            </div>
        </form>

    </main>
    <script asp-src-include="/js/checkout.js"></script>
</body>
</html>
